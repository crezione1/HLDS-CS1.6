#!/bin/bash

IMAGE_NAME="cs16-server"
CONTAINER_NAME="cs16-server"

case $1 in
  build)
    echo "Building Docker image..."
    docker build -t $IMAGE_NAME /cstrike/HLDS-CS1.6/  # Updated path to the Dockerfile
    ;;

  start)
    if ! docker image inspect $IMAGE_NAME >/dev/null 2>&1; then
      echo "Image $IMAGE_NAME not found. Building the image..."
      docker build -t $IMAGE_NAME /cstrike/HLDS-CS1.6/  # Updated path to the Dockerfile
    fi
    echo "Starting the HLDS server..."
    docker run -d -p 27015:27015/udp -p 27015:27015/tcp --name $CONTAINER_NAME $IMAGE_NAME
    ;;

  stop)
    echo "Stopping the HLDS server..."
    docker stop $CONTAINER_NAME
    docker rm $CONTAINER_NAME
    ;;

  logs)
    extra_args=""
    if [[ $2 == "-f" ]] || [[ $2 == "--follow" ]]; then
      extra_args="-f"
    fi

    echo "Showing logs..."
    docker logs $extra_args $CONTAINER_NAME
    ;;

  *)
    echo "HLDS for CS 1.6"
    echo ""
    echo "Usage: $0 <build|start|stop|logs>"
    echo "To follow the logs (like tail -f), use '$0 logs -f'"
    ;;
esac
